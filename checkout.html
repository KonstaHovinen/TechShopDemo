<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout â€” TechShop</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <header class="header scrolled" id="header">
    <div class="header__inner container">
      <a href="index.html" class="logo">Tech<span>Shop</span></a>
      <div style="font-size:0.85rem;color:var(--clr-text-muted);">ðŸ”’ Secure Checkout</div>
    </div>
  </header>

  <div class="page-hero">
    <div class="container">
      <h1 class="page-hero__title">Checkout</h1>
      <p class="page-hero__subtitle">You're one step away.</p>
    </div>
  </div>

  <section class="page-section">
    <div class="container">
      <div class="checkout__layout">

        <!-- LEFT: FORM -->
        <div class="checkout__form-col">
          <h3 class="checkout__section-title">Contact Information</h3>
          <div class="form-group">
            <label for="co-email">Email</label>
            <input type="email" id="co-email" placeholder="your@email.com" />
          </div>

          <h3 class="checkout__section-title" style="margin-top:28px">Shipping Address</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="co-first">First name</label>
              <input type="text" id="co-first" placeholder="First name" />
            </div>
            <div class="form-group">
              <label for="co-last">Last name</label>
              <input type="text" id="co-last" placeholder="Last name" />
            </div>
          </div>
          <div class="form-group">
            <label for="co-address">Address</label>
            <input type="text" id="co-address" placeholder="Street address" />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="co-city">City</label>
              <input type="text" id="co-city" placeholder="City" />
            </div>
            <div class="form-group">
              <label for="co-zip">Postal code</label>
              <input type="text" id="co-zip" placeholder="00000" />
            </div>
          </div>

          <h3 class="checkout__section-title" style="margin-top:28px">Payment</h3>
          <div class="form-group">
            <label for="co-card">Card number</label>
            <input type="text" id="co-card" placeholder="1234 5678 9012 3456" maxlength="19" />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="co-exp">Expiry</label>
              <input type="text" id="co-exp" placeholder="MM / YY" maxlength="7" />
            </div>
            <div class="form-group">
              <label for="co-cvv">CVV</label>
              <input type="text" id="co-cvv" placeholder="â€¢â€¢â€¢" maxlength="3" />
            </div>
          </div>

          <button class="btn btn--primary btn--lg btn--full" id="payBtn" style="margin-top:24px">
            Pay Now â†’
          </button>
          <p class="checkout__secure-note">ðŸ”’ Your payment info is encrypted and never stored.</p>
        </div>

        <!-- RIGHT: ORDER SUMMARY -->
        <div class="checkout__summary-col">
          <h3 class="checkout__section-title">Order Summary</h3>
          <div id="checkoutItems" class="checkout__items"></div>
          <div class="checkout__summary-total">
            <span>Total</span>
            <strong id="checkoutTotal">â‚¬0.00</strong>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- PROCESSING OVERLAY -->
  <div class="processing-overlay" id="processingOverlay">
    <div class="processing-box">
      <div class="processing-spinner"></div>
      <p class="processing-text" id="processingText">Processing paymentâ€¦</p>
    </div>
  </div>

  <div class="toast" id="toast"></div>
  <script src="main.js"></script>
  <script>
    // PRODUCTS and cart are already defined by main.js â€” use them directly.
    // Populate order summary once DOM is ready.
    document.addEventListener('DOMContentLoaded', function() {
      var entries = Object.values(cart);
      var itemsEl = document.getElementById('checkoutItems');
      var totalEl = document.getElementById('checkoutTotal');

      if (!entries.length) {
        itemsEl.innerHTML = '<p style="color:var(--clr-text-muted);font-size:0.9rem;">No items in cart.</p>';
      } else {
        var total = 0;
        itemsEl.innerHTML = entries.map(function(item) {
          total += item.price * item.qty;
          var emoji = (PRODUCTS[item.id] && PRODUCTS[item.id].emoji) ? PRODUCTS[item.id].emoji : 'ðŸ“¦';
          return '<div class="checkout__item">' +
            '<span class="checkout__item-emoji">' + emoji + '</span>' +
            '<div class="checkout__item-info">' +
              '<span class="checkout__item-name">' + item.name + '</span>' +
              '<span class="checkout__item-qty">Ã— ' + item.qty + '</span>' +
            '</div>' +
            '<span class="checkout__item-price">â‚¬' + (item.price * item.qty).toFixed(2) + '</span>' +
          '</div>';
        }).join('');
        totalEl.textContent = 'â‚¬' + total.toFixed(2);
      }

      // Format card input
      document.getElementById('co-card').addEventListener('input', function(e) {
        var v = e.target.value.replace(/\D/g,'').substring(0,16);
        e.target.value = v.replace(/(.{4})/g,'$1 ').trim();
      });
      document.getElementById('co-exp').addEventListener('input', function(e) {
        var v = e.target.value.replace(/\D/g,'').substring(0,4);
        if (v.length > 2) v = v.substring(0,2) + ' / ' + v.substring(2);
        e.target.value = v;
      });

      // Pay button â€” simulate processing then redirect
      document.getElementById('payBtn').addEventListener('click', function() {
        var overlay = document.getElementById('processingOverlay');
        var text    = document.getElementById('processingText');
        overlay.classList.add('show');
        setTimeout(function() { text.textContent = 'Verifying card detailsâ€¦'; }, 1000);
        setTimeout(function() { text.textContent = 'Confirming orderâ€¦'; }, 2200);
        setTimeout(function() {
          localStorage.removeItem('nb_cart');
          window.location.href = 'success.html';
        }, 3400);
      });
    });
  </script>
</body>
</html>
